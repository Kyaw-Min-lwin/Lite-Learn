{% extends 'core/base.html' %}

{% block content %}
<div class="text-center" style="margin-bottom: 48px;">
    <h1 style="margin-bottom: 8px;">Low-Bandwidth Learning</h1>
    <p class="text-muted" style="max-width: 500px; margin: 0 auto;">
        Upload heavy lectures or paste YouTube links. We compress them into bite-sized audio and study guides.
    </p>
</div>

<div class="card" id="main-card">
    <!-- Tabs -->
    <div class="flex-row" style="margin-bottom: 24px;">
        <button type="button" onclick="switchTab('youtube')" id="btn-yt" class="btn btn-outline active">
            üì∫ YouTube Link
        </button>
        <button type="button" onclick="switchTab('file')" id="btn-file" class="btn btn-outline">
            üìÅ File Upload
        </button>
    </div>

    <form method="post" enctype="multipart/form-data" onsubmit="showLoader()">
        {% csrf_token %}

        <!-- Title Input -->
        <div style="margin-bottom: 24px;">
            <label style="font-weight: 600; font-size: 0.9em; display: block; margin-bottom: 8px; color: var(--text-muted);">
                LABEL YOUR CONTENT
            </label>
            {{ form.title }}
        </div>

        <!-- YouTube Section -->
        <div id="youtube-section">
            <label style="font-weight: 600; font-size: 0.9em; display: block; margin-bottom: 8px; color: var(--text-muted);">
                PASTE URL
            </label>
            {{ form.youtube_url }}
            <div
                style="font-size: 0.85em; color: var(--primary-dark); background: var(--primary-light); padding: 8px 12px; border-radius: 6px; display: inline-block;">
                ‚ö° Tip: YouTube is faster because we don't need to upload a file first.
            </div>
        </div>

        <!-- File Section -->
        <div id="file-section" class="hidden">
            <label style="font-weight: 600; font-size: 0.9em; display: block; margin-bottom: 8px; color: var(--text-muted);">
                SELECT FILE (MP4, MKV)
            </label>
            {{ form.original_video }}
        </div>

        <div style="margin-top: 32px;">
            <button type="submit" class="btn">üöÄ Start Processing</button>
        </div>
    </form>
</div>

<!-- Refined Loader -->
<div id="loader" style="display: none; text-align: center; padding-top: 40px;">
    <div class="spinner"></div>
    <h3 style="margin-top: 20px;">Crunching Data...</h3>
    <p class="text-muted">Extracting audio & generating AI notes.</p>
</div>
<style>
    /* CSS Spinner - GPU Accelerated */
    .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid var(--border);
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>

<script>
    function switchTab(mode) {
        const ytSection = document.getElementById('youtube-section');
        const fileSection = document.getElementById('file-section');
        const btnYt = document.getElementById('btn-yt');
        const btnFile = document.getElementById('btn-file');

        if (mode === 'youtube') {
            ytSection.style.display = 'block';
            fileSection.style.display = 'none';
            btnYt.classList.add('active');
            btnFile.classList.remove('active');
            document.querySelector('input[type="file"]').value = '';
        } else {
            ytSection.style.display = 'none';
            fileSection.style.display = 'block';
            btnFile.classList.add('active');
            btnYt.classList.remove('active');
            document.querySelector('input[type="url"]').value = '';
        }
    }

    function showLoader() {
        // Fade out card smoothly
        const card = document.getElementById('main-card');
        card.style.opacity = '0.5';
        card.style.pointerEvents = 'none';
        document.getElementById('loader').style.display = 'block';
    }

        // Set default input placeholders via JS to keep HTML clean
        window.onload = function () {
            document.querySelector('input[name="title"]').placeholder = "e.g. Intro to Neural Networks";
            document.querySelector('input[name="youtube_url"]').placeholder = "https://youtube.com/watch?v=...";
        }
</script>
{% endblock %}